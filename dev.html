<!DOCTYPE html>
<html>
<head>
<meta charset="utf-8">
<title>ic-sortable</title>
  <link rel="stylesheet" href="http://cdnjs.cloudflare.com/ajax/libs/normalize/2.1.0/normalize.css">
</head>
<body>
  <script src="http://ajax.googleapis.com/ajax/libs/jquery/1.10.2/jquery.min.js"></script>
  <script src="https://rawgithub.com/voidberg/html5sortable/master/jquery.sortable.js"></script>
  <script src="http://builds.emberjs.com/handlebars-1.0.0.js"></script>
  <script src="http://builds.emberjs.com/tags/v1.0.0/ember.js"></script>

  <script>
  App = Ember.Application.create();

  var kids = Ember.ArrayProxy.create({content: []});
  kids.addObject({
    name: 'John',
    chores: Ember.ArrayProxy.create({content: [
      'Dishes',
      'Laundry'
    ]})
  });

  kids.addObject({
    name: 'Jane',
    chores: Ember.ArrayProxy.create({content: [
      'Sweep floor',
      'Mow lawn'
    ]})
  });

  kids.addObject({
    name: 'Jimmy',
    chores: Ember.ArrayProxy.create({content: [
      'Vacuum',
      'Take trash out'
    ]})
  });

  App.ApplicationController = Ember.Object.extend({
    kids: kids
  });

  // App.ApplicationView = Ember.View.extend({
  //   didInsertElement: function() {
  //     $('.sortable').sortable();
  //   }
  // });

  // App.IcSortableItem = Ember.View.extend({
    
  // });

  var CustomElement = Ember.Mixin.create({
    init: function() {
      this._super.apply(this, arguments);
      var name = this.constructor.toString().split('.')[1]
        .camelize().dasherize().replace(/-component$/, '');
      document.createElement(name);
      this.set('tagName', name);
    }
  });

  App.IcSortableComponent = Ember.Component.extend(CustomElement,{

  });

  App.IcSortableComponent = Ember.Component.extend(CustomElement,{
    // classNames: ['primary'],
    didInsertElement: function() {
      this.$().sortable({
        items: this.$('> ic-sortable-item'),
        connectWith: this.get('connect-with'),
        handle: this.$('.ic-drag-handler[data-connect-with="' + this.get('connect-with') + '"]'),
        forcePlaceholderSize: true
      });
      // alert(this.get('connect-with'));
    }
  });

  App.IcSortableListItemComponent = Ember.Component.extend(CustomElement,{

  });
  </script>

  <script type="text/x-handlebars">
    <h2>Drag and Drop Using Ember Components and voidberg/html5sortable</h2>
    
    {{#ic-sortable connect-with="modules-sortable"}}
      {{#each kids}}
        {{#ic-sortable-item}}
          <div>
            <span class="ic-drag-handler" data-connect-with="modules-sortable">[Handler]</span>
            {{name}}
            <ul>
            {{#ic-sortable connect-with="items-sortable"}}
              {{#each chores}}
                {{#ic-sortable-item}}
                  <li>
                    <span class="ic-drag-handler" data-connect-with="items-sortable">[Handler]</span>
                    {{this}}
                  </li>
                {{/ic-sortable-item}}
              {{/each}}
            {{/ic-sortable}}
            </ul>
          </div>
        {{/ic-sortable-item}}
      {{/each}}
    {{/ic-sortable}}
  </script>

  <script type="text/x-handlebars" id="components/ic-sortable">
    {{yield}}
  </script>

  <script type="text/x-handlebars" id="components/ic-sortable-list">
    {{yield}}
  </script>

  <script type="text/x-handlebars" id="components/ic-sortable-item">
    {{yield}}
  </script>
</body>
</html>
